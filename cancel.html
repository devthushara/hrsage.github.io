<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Successful - HR SAGE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sage: { 900: '#344C3D', 50: '#F0F4F0' }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-sage-50 min-h-screen flex items-center justify-center p-4 font-sans text-neutral-800">

    <div class="bg-white max-w-md w-full rounded-3xl shadow-xl p-8 text-center border border-gray-100 relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-green-400 to-sage-900"></div>

        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm">
            <i class="fa-solid fa-check text-4xl text-green-500"></i>
        </div>

        <h1 class="text-3xl font-bold text-sage-900 mb-2">Payment Successful!</h1>
        
        <p class="text-gray-500 mb-6 text-sm leading-relaxed">
            We will reach you via email. Please check your registered email address <br>
            <span id="user-email" class="font-bold text-sage-900 bg-sage-50 px-2 py-1 rounded border border-gray-200 animate-pulse">loading email...</span>
            <br> for your license keys.
        </p>
        
        <p class="text-xs text-gray-400 mb-8">
            Please keep the provided transaction ID safe until you receive that email.
        </p>

        <div class="bg-gray-50 rounded-xl p-4 mb-8 text-left border border-gray-100">
            <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Transaction ID</p>
            <p id="session-id" class="text-sm font-mono text-gray-700 break-all">Verifying...</p>
        </div>

        <a href="/" class="block mt-4 text-sm text-gray-400 hover:text-sage-900 font-medium">
            Return to Homepage
        </a>
    </div>

    <script>
        // 1. Get Session ID
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session_id');
        const emailDisplay = document.getElementById('user-email');
        const idDisplay = document.getElementById('session-id');

        if (sessionId) {
            idDisplay.textContent = sessionId;
            
            // 2. Fetch Email from Netlify Function
            fetch(`/.netlify/functions/get-session?session_id=${sessionId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.email) {
                        // Success: Show Email
                        emailDisplay.textContent = data.email;
                        emailDisplay.classList.remove('animate-pulse');
                        emailDisplay.classList.add('text-green-700');
                    } else {
                        // Fallback if no email found
                        emailDisplay.textContent = "your inbox";
                        emailDisplay.classList.remove('animate-pulse');
                    }
                })
                .catch(err => {
                    console.error(err);
                    emailDisplay.textContent = "your inbox"; // Fallback on error
                });

        } else {
            idDisplay.textContent = "No ID found";
            emailDisplay.textContent = "your inbox";
            emailDisplay.classList.remove('animate-pulse');
        }
    </script>
</body>
</html>